local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Sir Doom",
    Icon = 0,
    LoadingTitle = "Sdoom",
    LoadingSubtitle = "by Doom",
    Theme = "Default",
    DisableRayfieldPrompts = false,
    DisableBuildWarnings = false,
    ConfigurationSaving = {
        Enabled = true,
        FolderName = nil,
        FileName = "lua Hub"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "Untitled",
        Subtitle = "Key System",
        Note = "No method of obtaining the key is provided",
        FileName = "Key",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = {"Hello"}
    }
})

local Tab = Window:CreateTab("MainTab")
local Section = Tab:CreateSection("Main")

-- Tracer için global bir tablo ve güncelleme bağlantısı
local tracers = {}
local tracerUpdateConnection

-- Tracer güncelleme fonksiyonu
local function updateTracers()
    local Camera = workspace.CurrentCamera
    local LocalPlayer = game:GetService("Players").LocalPlayer

    for player, tracer in pairs(tracers) do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local characterPosition = player.Character.HumanoidRootPart.Position
            local screenPosition, onScreen = Camera:WorldToViewportPoint(characterPosition)

            if onScreen then
                tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                tracer.To = Vector2.new(screenPosition.X, screenPosition.Y)
                tracer.Visible = true
            else
                tracer.Visible = false
            end
        end
    end
end

-- Toggle komutu ile tracer'ı aç/kapat
local Toggle = Tab:CreateToggle({
    Name = "Tracer Toggle",
    CurrentValue = false,
    Flag = "Toggle1",
    Callback = function(Value)
        local Players = game:GetService("Players")

        if Value then
            -- Tracer'ları oluştur ve güncellemeye başla
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= Players.LocalPlayer then
                    local tracer = Drawing.new("Line")
                    tracer.Thickness = 2
                    tracer.Color = Color3.fromRGB(255, 255, 255)
                    tracer.Transparency = 1
                    tracers[player] = tracer
                end
            end

            -- Yeni oyuncu eklendiğinde tracer oluştur
            Players.PlayerAdded:Connect(function(player)
                if player ~= Players.LocalPlayer then
                    local tracer = Drawing.new("Line")
                    tracer.Thickness = 2
                    tracer.Color = Color3.fromRGB(255, 255, 255)
                    tracer.Transparency = 1
                    tracers[player] = tracer
                end
            end)

            -- Tracer'ları her karede güncelle
            tracerUpdateConnection = game:GetService("RunService").RenderStepped:Connect(updateTracers)

        else
            -- Tracer'ları kaldır ve güncellemeyi durdur
            for _, tracer in pairs(tracers) do
                tracer:Remove()
            end
            tracers = {}

            if tracerUpdateConnection then
                tracerUpdateConnection:Disconnect()
                tracerUpdateConnection = nil
            end
        end
    end,
})

-- Highlight ESP Toggle
local highlightEnabled = false
local highlightedPlayers = {}

local Toggle2 = Tab:CreateToggle({
    Name = "highlight esp",
    CurrentValue = false,
    Flag = "Toggle2",
    Callback = function(Value)
        highlightEnabled = Value

        -- Remove highlights when toggle is turned off
        if not highlightEnabled then
            for , player in pairs(highlightedPlayers) do
                if player.Character and player.Character:FindFirstChild("Head") then
                    local highlight = player.Character.Head:FindFirstChild("Highlight")
                    if highlight then
                        highlight:Destroy()
                    end
                end
            end
            highlightedPlayers = {}
        end
    end
})

-- Function to Add Highlight
local function addHighlight(player)
    if player.Character and player.Character:FindFirstChild("Head") then
        local highlight = Instance.new("Highlight")
        highlight.Name = "Highlight"
        highlight.Adornee = player.Character.Head
        highlight.Parent = player.Character.Head
        highlight.FillColor = Color3.fromRGB(255, 255, 0) -- Yellow color for highlight
        highlight.FillTransparency = 0.5
        table.insert(highlightedPlayers, player)
    end
end

-- Function to Remove Highlight
local function removeHighlight(player)
    if player.Character and player.Character:FindFirstChild("Head") then
        local highlight = player.Character.Head:FindFirstChild("Highlight")
        if highlight then
            highlight:Destroy()
        end
    end
end

-- Update Highlight ESP
game:GetService("Players").PlayerAdded:Connect(function(player)
    if highlightEnabled then
        addHighlight(player)
    end
end)

game:GetService("Players").PlayerRemoving:Connect(function(player)
    removeHighlight(player)
end)

-- Initial Highlight for Players Already in the Game
for , player in pairs(game:GetService("Players"):GetPlayers()) do
    if highlightEnabled then
        addHighlight(player)
    end
end


Rayfield:LoadConfiguration()
